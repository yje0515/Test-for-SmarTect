<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/base">

<head>
    <title>게시판</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/board.css}">
</head>

<body>

<section layout:fragment="content">

    <div class="board-container">

        <!-- 왼쪽: 게시글 목록 -->
        <div class="board-list">
            <div class="board-header">
                <h2>게시판</h2>
                <div class="board-search">
                    <input type="text" id="boardSearch" placeholder="검색어 입력">
                    <button onclick="loadBoard()">검색</button>
                </div>
            </div>

            <ul id="postList" class="post-list"></ul>

            <div class="pagination">
                <button onclick="prevPage()">이전</button>
                <span id="pageInfo">1 / 1</span>
                <button onclick="nextPage()">다음</button>
            </div>
        </div>

        <!-- 오른쪽: 상세보기 -->
        <div class="board-detail">
            <h2>게시글 상세</h2>
            <div id="detailBox" class="detail-box">
                <p>게시글을 선택하세요.</p>
            </div>
        </div>

    </div>

</section>

<script>
    let page = 1;

    // 목록 로딩
    function loadBoard() {
        const keyword = document.getElementById("boardSearch").value || "";

        fetch(`/api/board?page=${page}&keyword=${keyword}`)
            .then(res => res.json())
            .then(data => {

                const list = document.getElementById("postList");
                list.innerHTML = "";

                if (!data.posts || data.posts.length === 0) {
                    list.innerHTML = "<li>게시글이 없습니다.</li>";
                    return;
                }

                data.posts.forEach(post => {
                    const li = document.createElement("li");
                    li.className = "post-item";
                    li.innerHTML = `
                        <strong>${post.title}</strong><br>
                        <small>${post.author} · ${post.createdAt.replace("T"," ")}</small>
                    `;
                    li.onclick = () => loadDetail(post.id);
                    list.appendChild(li);
                });

                document.getElementById("pageInfo").innerText = `${data.page} / ${data.totalPage}`;
            });
    }

    // 상세 로딩
    function loadDetail(id) {
        fetch(`/api/board/${id}`)
            .then(res => res.json())
            .then(post => {
                const box = document.getElementById("detailBox");

                box.innerHTML = `
                    <h3>${post.title}</h3>
                    <p style="opacity:0.7">${post.author} · ${post.createdAt.replace("T"," ")}</p>
                    <hr>
                    <p>${post.content}</p>
                `;
            });
    }

    // 페이징
    function prevPage() {
        if (page > 1) {
            page--;
            loadBoard();
        }
    }

    function nextPage() {
        page++;
        loadBoard();
    }

    window.onload = loadBoard;
</script>

</body>
</html>
